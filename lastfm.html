<!DOCTYPE html>
<html lang="en">

		<head>
				<meta charset="utf-8">
				<title>Last.fm: Testing the JSON</title>
				<!--<<script src="d3/d3.v3.js" charset="utf-8"></script>-->
				<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>


		</head>
<style>
</style>

<body>


			<form>
			Username: <input type="text" name="userName" id="userName"><br>
			<!--State: <input type="text" name="userName" id="state">--><br>
			<input name="updateButton" 
           type="button" 
           value="Update" />
			</form>


<script>

"use strict";

var w = 300,
	h = 300,
	outerRadius = w / 2,
	innerRadius = w / 3, 
	arc = d3.svg.arc()
			.innerRadius(innerRadius)
			.outerRadius(outerRadius),
	pie = d3.layout.pie(),
	color = d3.scale.category20b();


var svg = d3.select("body")
	.append("svg")
	.attr("width", w)
	.attr("height", h);




d3.select('input[type=button]').on('click', function() {
  
  var userText = document.getElementById('userName').value,
      dataset;

      console.log(userText);

  var top = 'http://ws.audioscrobbler.com/2.0/?method=user.gettopartists&user=' + userText + '&api_key=07eef8055a0b408f70b1b3d5039bbaf5&format=json&period=12month&limit=20';


  d3.select("body")
    .append("p")
    .text("Test!");

  d3.json(top, function(error, json) {

	    if(error) { return console.log(error); } 
	  	console.log(json);
		dataset = json; 

	 	//Set up groups
		var arcs = svg.selectAll("g.arc")
				.data(pie(dataset.topartists.artist))
				.enter()
				.append("g")
				.attr("class", "arc")
				.attr("transform", "translate(" + outerRadius + "," + outerRadius + ")");

					//Draw arc paths
			arcs.append("path")
			    .attr("fill", function(d, i) {
			    	return color(i);
			    })
			    .attr("d", arc);



  }); //json call


}); //on click function


</script>
</body>
</html>